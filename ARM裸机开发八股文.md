# 一、ARM处理器
## 1.CPU的内部结构？
CPU的内部结构大致可以分为:
- 控制单元（指令寄存器、指令译码器、操作控制器）。
- 运算单元（算术逻辑单元）。
- 存储单元（专用寄存器和通用寄存器）
- 时钟。
## 2.CPU跟内存、虚拟内存、硬盘的关系？
- CPU要调用的**程序和数据来自硬盘**，但是**CPU又不能直接读写硬盘**上的系统、程序和数据，所以必须**先将硬盘的内容存储在内存中，才能被CPU读写**。
- **当系统需要的内存空间大于实际的物理内存空间**时，就需要用到虚拟内存了。**虚拟内存可以将部分硬盘空间模拟成内存空间**，**将暂时不运行的程序和不使用的数据存储在硬盘上，需要时再将其存储到内存**。
## 3.ARM结构处理器可分为哪几类？

| 嵌入式**微处理器** | 32位以上的处理器，具有较高的性能。                                                             |
| ----------- | ------------------------------------------------------------------------------ |
| 嵌入式**微控制器** | 典型代表是单片机，一般以某一种微处理器内核为核心，芯片内部集成Flash、RAM、EEPROM、总线、总线逻辑、定时/计数器、串行接口等各种必要的功能模块。 |
| 嵌入式DSP      | 对系统结构和指令进行了特殊设计，使其适合于执行DSP算法，编译效率较高，执行执行速度也较快                                  |
## 4.嵌入式微处理器(单片机)和DSP有什么区别？
- 嵌入式微处理器和DSP**一个偏重控制、一个偏重运算**。
- **嵌入式微处理器外围接口丰富，标准化、通用性、功耗控制**等做得很好，适用于消费电子、家用电器等控制领域。
- DSP对系统结构和指令做了优化，能进行大量数据的快速计算，适用于音视频处理等领域
## 5.ARM处理器有哪些工作状态？ARM指令和Thumb指令有什么区别？
ARM处理器共有ARM、Thumb/Thumb-2、调试三种状态。
- ARM指令是32位的，较全面；Thumb指令是16位的，较精简

| ARM状态     | 工作于32位指令状态，所有指令均为32位。                                                               |
| --------- | ----------------------------------------------------------------------------------- |
| Thumb状态   | 工作于16位指令状态，所有指令均为16位。                                                               |
| Thumb-2状态 | Thumb-2状态兼有16和32位指令，具有更高的性能、更低的功耗以及更少的内存占用。具有Thumb-2技术的ARM处理器无需在ARM和Thumb-2状态之间切换了。 |
| 调试状态      | 处理器停机调试。                                                                            |
## 6.RISC（精简指令集计算机）和CISC（复杂指令集计算机）的区别？
- RISC控制器多采用**硬件连线控制**方式，以期更快的执行速度；而CISC控制器绝大多数采用**微程序控制方式**。
- RISC只有**加载和存储指令可以访问内存**，**数据处理指令只对寄存器的内容操作**，为了加速程序的运算，RISC会设置多组寄存器，并指定特殊用途的寄存器，因此通用寄存器数量较CISC多。CISC架构允许数据处理指令对内存进行操作，因此需要的寄存器数量比较少。
- **RISC大多指令在一个时钟周期内完成**，且指令长度统一、数目少；而CISC的复杂指令通过CPU内的微码来完成，需要多个时钟周期，且指令长度不一、数目多。
- RISC在实现一个功能的时候，需要的指令数目多，编译器设计就更复杂；CISC的指令丰富，它的编译器可以少做很多事情。
- **RISC较CISC更易实现指令流水线**，因为其指令大多在一个时钟周期内完成。
## 7.ARM内部传输数据的总线有哪些？
ARM内部传输数据采用AMBA总线，共有四个版本：
- AMBA1：ASB、APB；
- AMBA2：AHB、APB；
- AMBA3：AHB、AXI、ATB、APB；
- AMBA4：AXI、ATB、ACE、APB。
# 二、中断
## 1.单片机使用中断时，编写ISR(中断服务程序)的注意事项
- 中断服务程序本身没有输入参数和返回参数
- 关键字 `__interrupt`
- 尽量不进行浮点运算和打印操作
## 2.简述处理器中断处理的过程
中断请求(中断触发) --> 中断响应(对中断进行系列处理，复位什么的) --> 中断服务函数(中断触发的服务函数，**包括了清除标志位**) --> 中断返回(继续中断触发，恢复现场的过程) --> 结束
## 3.保护现场、恢复现场的过程？
### 3.1 保护现场
 保护现场的目的是将当前程序的状态保存起来，以便在中断处理完成后能够恢复到中断发生时的状态。
1. 首先将R0~R7（快速中断）或R0~R12（其他中断）的值PUSH进堆栈中保存，并将堆栈指针保存在对应中断模式的R13（SP）中。
2. 把即将执行的下一条指令（PC-4）的地址保存到对应中断模式的R14（LR）中；把CPSR的值保存到对应中断模式的SPSR中，以实现对处理器当前状态、中断屏蔽及各标志位的保护。
- `PC` 程序计数器（Program Counter），用于存储当前正在执行的指令的地址。
- `PC-4` 减去4字节，下一条指令地址
- `CPSR`当前程序状态寄存器（Current Program Status Register）
- `SPSR`保存的程序状态寄存器（Saved Program Status Register）
3. **设置CPSR的相应位**：设置`CPSR[4:0]`的5位以进入相应的工作模式；`CPSR[5] = 0`切换到ARM状态；设置`CPSR[7] = 1`禁止IRQ中断；如果进入复位模式或FIQ模式，还要设置`CPSR[6] = 1`以禁止FIQ中断。
- **IRQ**：普通中断请求，用于处理一般性的中断事件
- **FIQ**：快速中断请求，用于处理对时间敏感的中断事件，如实时性要求高的任务
4. 给程序计数器PC强制赋值，转入中断向量地址，执行相应的中断服务程序。
### 3.2 恢复现场
1. 将原来保存在堆栈中的R0~R12或R0~R7 POP出栈，赋值给相应的寄存器。
2. 将LR的值赋值给PC，将SPSR的值赋值给CPSR中，恢复被中断的程序状态。
## 4.复位中断与其他中断有什么不同？
- 当中断产生后，复位中断立即中止当前指令的执行，其余情况都是当处理器完成当前指令后，再去响应中断。
- 如果是复位中断，系统自动从0x00000000开始**重新执行程序**，无需中断返回。
## 5.什么是中断向量？什么是中断嵌套？
1. 中断向量：中断服务子程序的入口地址。
2. 中断嵌套：中断系统正在执行一个中断服务程序时，有另一个优先级更高的中断源提出请求，这时会暂停当前正在执行的级别较低的中断源的服务程序，处理级别更高的中断源。处理完毕后再返回到被中断了的中断服务程序。
## 6.外部中断请求（IRQ）和快速中断请求（FIQ）的异常向量地址分别为？
在ARM架构中，**异常向量地址**是指处理器在发生异常或中断时，自动跳转到的固定内存地址。

| 异常类型          | 向量地址           |
| ------------- | -------------- |
| 复位（Reset）     | 0x00000000     |
| 未定义指令         | 0x00000004     |
| 软件中断（SWI）     | 0x00000008     |
| 预取指令异常        | 0x0000000C     |
| 数据异常          | 0x00000010     |
| 保留            | 0x00000014     |
| **外部中断（IRQ）** | **0x00000018** |
| **快速中断（FIQ）** | **0x0000001C** |
## 7.中断的优缺点？
- 优点：实现CPU和I/O设备的并行，提高CPU的利用率和系统的性能。
- 缺点：中断处理过程需要保护现场、恢复现场，整个过程需要一定的时间和空间开销。如果中断的频率太高，会降低系统的性能。（**需要占用额外的开销**）
## 8.中断服务程序能不能有参数和返回值？
- 在单片机裸机程序中，中断服务程序既不能有参数，也不能有返回值。
- 但是在带操作系统的嵌入式系统中，中断服务程序可以有参数，也可以有返回值。
# 三、寄存器与存储器
## 1.ARM的31个通用寄存器R0~R15中，程序计数器**PC为R15**、程序链接寄存器**LR为R14**、堆栈指针寄存器**SP为R13**
## 2.寄存器掉电会丢失数据吗？
寄存器是由触发器构成的，因此掉电**会丢失数据**
## 3.NOR Flash与NAND Flash的区别？

|      | NOR Flash                                                     | NAND Flash                           |
| ---- | ------------------------------------------------------------- | ------------------------------------ |
| 单位   | 字节                                                            | 页（一般为512字节）                          |
| 容量   | 一般为1~16MB                                                     | 一般为8~128M                            |
| 成本   | 较高                                                            | 较低                                   |
| 性能   | 读速度比NAND Flash稍快                                              | 写入、擦除速度比NOR Flash快很多                 |
| 接口   | 带有SRAM接口，有足够的地址引脚来寻址，可以很容易地存取其内部的每一个字节                        | 使用复杂的I/O口来串行地存取数据，8个引脚用来传送控制、地址和数据信息 |
| 耐用性  | 最大擦写次数是十万次                                                    | 最大擦写次数是一百万次                          |
| 软件支持 | 写入和擦除都需要MTD（Memory Technology Devices，内存技术驱动程序），运行代码不需要任何软件支持 | 写入和擦除都需要MTD，运行代码也要需要MTD              |
## 4. SRAM、DRAM、SDRAM的区别？
1. SRAM：静态的随机存储器，加电情况下，不需要刷新，数据不会丢失，CPU的缓存就是SRAM。
2. DRAM：动态随机存储器，加电情况下，也需要不断刷新，才能保存数据，最为常见的系统内存。
3. SDRAM：同步动态随机存储器，即数据的读取需要时钟来同步，也可用作内存。
## 5.磁盘跟硬盘的关系？
**磁盘包括**早期使用的软磁盘和现在经常使用的硬磁盘，硬磁盘简称硬盘
## 6.RAM是什么？
RAM是随机存储器，速度很快，可随机读写，但断电则丢失数据，一般用作内存
## 7.ROM是什么？
ROM是只读存储器，速度较慢，不能直接与CPU进行交互，断电后数据不丢失，一般用来保存断电不丢失的程序
- 常见的ROM有PROM、EPROM、EEPROM
## 8.SRAM跟DRAM的区别？

|       | SRAM | DRAM |
| ----- | ---- | ---- |
| 存储原理  | 触发器  | 电容   |
| 是否刷新  | 不需要  | 需要   |
| 运行速度  | 快    | 慢    |
| 存储成本  | 高    | 低    |
| 发热量   | 大    | 小    |
| 送行列地址 | 同时送  | 分两次送 |
| 破坏性读出 | 否    | 是    |
| 集成度   | 低    | 高    |
## 9.ARM在不同工作模式时使用的寄存器有所不同，但共同点是？
- R0~R7为公用的通用寄存器
- CPSR为公用的当前程序状态寄存器
- R15为公用的程序计数器PC
## 10.CPU要先对cache做什么，才能读取DMA数据？
CPU要先对cache做一个**invalidate（作废）操作**，再从内存中读取数据到缓存，保证缓存和内存中数据的一致性，才能读取DMA数据。
## 11.大小端各自的优点？用在何处？
- **大端优点**：符号位在低地址的第一个字节中，便于快速判数据的正负和大小。
- **小端优点**：低地址放低字节，所以在强制类型转换的时候不需要调整字节的内容。而且CPU做数值运算时从内存中依次从低到高取数值直到最后刷新最高位的符号位，这样的运算方式更高效。
- x86系列芯片采用小端模式，ARM芯片默认为小端模式，但可以切到大端。
- 大小端是由CPU架构决定的，不是软件决定的
## 12.缓冲技术的作用是？
- 改善CPU与I/O设备间**速度不匹配**的矛盾
- 提高CPU和I/O设备之间的并行性，提高系统的吞吐量和设备的利用率
- 减少对CPU中断的频率，放宽对中断响应时间的限制
## 13.缓冲技术的种类？
单缓冲、双缓冲、多缓冲、缓冲池