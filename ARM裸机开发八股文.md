# 一、ARM处理器
## 1.CPU的内部结构？
CPU的内部结构大致可以分为:
- 控制单元（指令寄存器、指令译码器、操作控制器）。
- 运算单元（算术逻辑单元）。
- 存储单元（专用寄存器和通用寄存器）
- 时钟。
## 2.CPU跟内存、虚拟内存、硬盘的关系？
- CPU要调用的**程序和数据来自硬盘**，但是**CPU又不能直接读写硬盘**上的系统、程序和数据，所以必须**先将硬盘的内容存储在内存中，才能被CPU读写**。
- **当系统需要的内存空间大于实际的物理内存空间**时，就需要用到虚拟内存了。**虚拟内存可以将部分硬盘空间模拟成内存空间**，**将暂时不运行的程序和不使用的数据存储在硬盘上，需要时再将其存储到内存**。
## 3.ARM结构处理器可分为哪几类？

| 嵌入式**微处理器** | 32位以上的处理器，具有较高的性能。                                                             |
| ----------- | ------------------------------------------------------------------------------ |
| 嵌入式**微控制器** | 典型代表是单片机，一般以某一种微处理器内核为核心，芯片内部集成Flash、RAM、EEPROM、总线、总线逻辑、定时/计数器、串行接口等各种必要的功能模块。 |
| 嵌入式DSP      | 对系统结构和指令进行了特殊设计，使其适合于执行DSP算法，编译效率较高，执行执行速度也较快                                  |
## 4.嵌入式微处理器(单片机)和DSP有什么区别？
- 嵌入式微处理器和DSP**一个偏重控制、一个偏重运算**。
- **嵌入式微处理器外围接口丰富，标准化、通用性、功耗控制**等做得很好，适用于消费电子、家用电器等控制领域。
- DSP对系统结构和指令做了优化，能进行大量数据的快速计算，适用于音视频处理等领域
## 5.ARM处理器有哪些工作状态？ARM指令和Thumb指令有什么区别？
ARM处理器共有ARM、Thumb/Thumb-2、调试三种状态。
- ARM指令是32位的，较全面；Thumb指令是16位的，较精简

| ARM状态     | 工作于32位指令状态，所有指令均为32位。                                                               |
| --------- | ----------------------------------------------------------------------------------- |
| Thumb状态   | 工作于16位指令状态，所有指令均为16位。                                                               |
| Thumb-2状态 | Thumb-2状态兼有16和32位指令，具有更高的性能、更低的功耗以及更少的内存占用。具有Thumb-2技术的ARM处理器无需在ARM和Thumb-2状态之间切换了。 |
| 调试状态      | 处理器停机调试。                                                                            |
## 6.RISC（精简指令集计算机）和CISC（复杂指令集计算机）的区别？
- RISC控制器多采用**硬件连线控制**方式，以期更快的执行速度；而CISC控制器绝大多数采用**微程序控制方式**。
- RISC只有**加载和存储指令可以访问内存**，**数据处理指令只对寄存器的内容操作**，为了加速程序的运算，RISC会设置多组寄存器，并指定特殊用途的寄存器，因此通用寄存器数量较CISC多。CISC架构允许数据处理指令对内存进行操作，因此需要的寄存器数量比较少。
- **RISC大多指令在一个时钟周期内完成**，且指令长度统一、数目少；而CISC的复杂指令通过CPU内的微码来完成，需要多个时钟周期，且指令长度不一、数目多。
- RISC在实现一个功能的时候，需要的指令数目多，编译器设计就更复杂；CISC的指令丰富，它的编译器可以少做很多事情。
- **RISC较CISC更易实现指令流水线**，因为其指令大多在一个时钟周期内完成。
## 7.ARM内部传输数据的总线有哪些？
ARM内部传输数据采用AMBA总线，共有四个版本：
- AMBA1：ASB、APB；
- AMBA2：AHB、APB；
- AMBA3：AHB、AXI、ATB、APB；
- AMBA4：AXI、ATB、ACE、APB。
# 二、中断
## 1.单片机使用中断时，编写ISR(中断服务程序)的注意事项
- 中断服务程序本身没有输入参数和返回参数
- 关键字 `__interrupt`
- 尽量不进行浮点运算和打印操作
## 2.简述处理器中断处理的过程
中断请求(中断触发) --> 中断响应(对中断进行系列处理，复位什么的) --> 中断服务函数(中断触发的服务函数，**包括了清除标志位**) --> 中断返回(继续中断触发，恢复现场的过程) --> 结束
## 3.保护现场、恢复现场的过程？
### 3.1 保护现场
 保护现场的目的是将当前程序的状态保存起来，以便在中断处理完成后能够恢复到中断发生时的状态。
1. 首先将R0~R7（快速中断）或R0~R12（其他中断）的值PUSH进堆栈中保存，并将堆栈指针保存在对应中断模式的R13（SP）中。
2. 把即将执行的下一条指令（PC-4）的地址保存到对应中断模式的R14（LR）中；把CPSR的值保存到对应中断模式的SPSR中，以实现对处理器当前状态、中断屏蔽及各标志位的保护。
- `PC` 程序计数器（Program Counter），用于存储当前正在执行的指令的地址。
- `PC-4` 减去4字节，下一条指令地址
- `CPSR`当前程序状态寄存器（Current Program Status Register）
- `SPSR`保存的程序状态寄存器（Saved Program Status Register）
3. **设置CPSR的相应位**：设置`CPSR[4:0]`的5位以进入相应的工作模式；`CPSR[5] = 0`切换到ARM状态；设置`CPSR[7] = 1`禁止IRQ中断；如果进入复位模式或FIQ模式，还要设置`CPSR[6] = 1`以禁止FIQ中断。
- **IRQ**：普通中断请求，用于处理一般性的中断事件
- **FIQ**：快速中断请求，用于处理对时间敏感的中断事件，如实时性要求高的任务
4. 给程序计数器PC强制赋值，转入中断向量地址，执行相应的中断服务程序。
### 3.2 恢复现场
1. 将原来保存在堆栈中的R0~R12或R0~R7 POP出栈，赋值给相应的寄存器。
2. 将LR的值赋值给PC，将SPSR的值赋值给CPSR中，恢复被中断的程序状态。
## 4.复位中断与其他中断有什么不同？
- 当中断产生后，复位中断立即中止当前指令的执行，其余情况都是当处理器完成当前指令后，再去响应中断。
- 如果是复位中断，系统自动从0x00000000开始**重新执行程序**，无需中断返回。
## 5.什么是中断向量？什么是中断嵌套？
1. 中断向量：中断服务子程序的入口地址。
2. 中断嵌套：中断系统正在执行一个中断服务程序时，有另一个优先级更高的中断源提出请求，这时会暂停当前正在执行的级别较低的中断源的服务程序，处理级别更高的中断源。处理完毕后再返回到被中断了的中断服务程序。
## 6.外部中断请求（IRQ）和快速中断请求（FIQ）的异常向量地址分别为？
在ARM架构中，**异常向量地址**是指处理器在发生异常或中断时，自动跳转到的固定内存地址。

| 异常类型          | 向量地址           |
| ------------- | -------------- |
| 复位（Reset）     | 0x00000000     |
| 未定义指令         | 0x00000004     |
| 软件中断（SWI）     | 0x00000008     |
| 预取指令异常        | 0x0000000C     |
| 数据异常          | 0x00000010     |
| 保留            | 0x00000014     |
| **外部中断（IRQ）** | **0x00000018** |
| **快速中断（FIQ）** | **0x0000001C** |
## 7.中断的优缺点？
- 优点：实现CPU和I/O设备的并行，提高CPU的利用率和系统的性能。
- 缺点：中断处理过程需要保护现场、恢复现场，整个过程需要一定的时间和空间开销。如果中断的频率太高，会降低系统的性能。（**需要占用额外的开销**）
## 8.中断服务程序能不能有参数和返回值？
- 在单片机裸机程序中，中断服务程序既不能有参数，也不能有返回值。
- 但是在带操作系统的嵌入式系统中，中断服务程序可以有参数，也可以有返回值。